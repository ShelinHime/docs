<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - WebSocket Transport</title>
    <link rel="stylesheet" type="text/css" href="/assets/stylesheet.css" media="screen">
    <link rel="shortcut icon" href="/assets/favicon.ico">

    <script src="/assets/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="/assets/vendor/prettify/prettify.css" media="screen">
    <script src="/assets/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="/assets/javascripts/application.js" type="text/javascript"></script>
    <script src="/assets/javascripts/lang-manager.js" type="text/javascript"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.4.3">
  </head>
  <body>
    <a href="https://github.com/ably/docs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/assets/forkme.png" alt="Fork me on GitHub"></a>
  <div id="documentation">
    <h2>Overview</h2>
<p>The Ably Realtime service supports client connections over multiple transports. The WebSocket transport is the primary<br />
transport for efficient connection by browser clients that are websocket-capable, and any other client environment that<br />
offers direct TCP socket access.</p>
<p>The WebSocket transport transmits Protocol Messages in a single WebSocket data frame. In the binary transport, these<br />
are sent as binary data frames, with the Protocol Message being encoded with the standard thrift binary encoding.<br />
In the text transport these are sent as text data frames containing JSON-encoded ProtocolMessage objects. The protocol<br />
definition specifies the content and interpretation of the various protocol messages.</p>
<p>This section defines details that are transport-specific, covering:</p>
<ul>
	<li>connection;</li>
	<li>disconnection;</li>
	<li>WebSocket protocol draft support.</li>
</ul>
<h2>Connection</h2>
<p>Establishment of a WebSocket transport requires that the client makes a WebSocket or secure WebSocket connection to the<br />
Ably WebSocket host (realtime.ably.io or one of the ws fallback hosts). The client library must allow the client to<br />
specify a non-default host, at least to be able to connect to the staging environment at staging-realtime.ably.io.</p>
<p>TLS connections are supported only for accounts that have TLS enabled. Certain apps may be configured to require TLS<br />
connections and will reject non-TLS connections.</p>
<p>The connection URI must be a valid WebSocket URI as specified in http://tools.ietf.org/html/rfc6455#section-3 with an<br />
empty path component. The URI must include a valid set of authorisation params and a valid set of connection params,<br />
each as specified below.</p>
<h3>Authorisation params</h3>
<p>Authorisation params must be either basic authorisation params or token authorisation params.</p>
<p>Basic auth params:</p>
<p>key_id (mandatory)<br />
key_value (mandatory)</p>
<p>The key_id and key_value are obtained from the library initialisation options.</p>
<p>Token auth params:</p>
<p>access_token (mandatory)</p>
<p>If the library has been initialised with a clientId then the authorisation params must include a &#8220;client_id&#8221; param with<br />
the clientId value. In the case of token auth, the token must either have been issued against that clientId or against<br />
the wildcard clientId.</p>
<h3>Connection params</h3>
<p>Connection params cover protocol mode and recovery mode.</p>
<p>Protocol mode is specified with the optional &#8220;binary&#8221; param:</p>
<p>binary (optional); possible values &#8220;true&#8221;, &#8220;false&#8221;; default if omitted is &#8220;true&#8221;.</p>
<p>The connection recovery mode is one of &#8220;clean&#8221;, &#8220;resume&#8221; or &#8220;recover&#8221;. Clean mode is the default, and is assumed if no<br />
connection params are specified.</p>
<p>Resume or recover mode are specified by including a &#8220;resume&#8221; or &#8220;recover&#8221; param respectively. In each case the value of<br />
that param is the connectionId string of the connection that is being recovered.</p>
<p>Resume and recover mode also require a &#8220;connection_serial&#8221; param to be specified whose value is the (decimal<br />
representation of the) serial number of the last message received.</p>
<h3>Failed connections</h3>
<p>In the event of a connection failure, the service may respond in two ways.</p>
<p>First, the service may simply refuse the connection and there will be no handshake. The library must report this to the<br />
client as a 401 Unauthorized error with no further error information.</p>
<p>Alternatively, the service may accept the WebSocket connection and complete the handshake, and then send an ERROR<br />
Protocol Message with further error information, followed by a normal close of the WebSocket connection. In this case<br />
the library must report that error information as the reason for connection failure to the client.</p>
<p>At any time after a successful connection, the service may initiate termination of the connection by sending an ERROR<br />
message; this might occur for example if the credentials have been revoked, or the account has breached a hard<br />
connection limit. If a connection ERROR message is received, the error information must be passed to the client as the<br />
failure reason.</p>
<h2>Disconnection</h2>
<p>Disconnection of the transport, in the case that the client wishes to be able to recover connection state, simply<br />
requires the client to perform a normal close on the WebSocket.</p>
<p>Closing the connection, resulting in disposal of connection state, is achieved by sending a DISCONNECT message. The<br />
client can then perform a normal close on the WebSocket.</p>
<p>Abnormal termination for whatever reason (a transition to the failed connection state) again just requires a normal<br />
close of the WebSocket.</p>
<p>WebSocket close events that are initiated by the remote end are handled as follows.</p>
<p>A normal close, if the client end had already initiated an explicit DISCONNECT, are reported to the client as a<br />
transition to the closed state.</p>
<p>Any other normal close, or a close with one of the following codes:</p>
<ul>
	<li>GOING_AWAY (1001)</li>
	<li>ABNORMAL_CLOSE (1006)</li>
</ul>
<p>is reported to the client as a transition to the disconnected or the suspended state,<br />
depending on whether or not the client has exceeded the suspended timeout.</p>
<p>Any close with any of the following codes:</p>
<ul>
	<li>CLOSE_PROTOCOL_ERROR (1002)</li>
	<li>REFUSE (1003)</li>
	<li>NO_UTF8 (1007)</li>
	<li>POLICY_VALIDATION (1008)</li>
	<li>TOOBIG (1009)</li>
	<li>EXTENSION (1010)</li>
	<li>UNEXPECTED_CONDITION (1011)</li>
	<li>TLS_ERROR (1015)</li>
</ul>
<p>is reported as a transition to the failed state. The reason code is derived from the reported<br />
WebSocket reason code as follows:</p>
<ul>
	<li>REFUSE, POLICY_VALIDATION : 40100;</li>
	<li>TOOBIG : 40000;</li>
	<li>any other code : 80000.</li>
</ul>
<h2>WebSocket protocol draft support</h2>
<p>Clients must use the RFC 6455 WebSocket protocol. Browsers that support earlier drafts are accommodated by the service<br />
based on specific knowledge of the state of those browser&#8217;s conformance to a particular draft; the Ably service does<br />
attempt to comply with any draft other than the RFC.</p>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/assets/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/root/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/root/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/root/usage-limits-billing/'>Usage Limits &amp; Billing</a></li>
</ul>
  <h2><a href="/realtime/">Real-time client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class=''><a href='/realtime/authentication/'>Authentication</a></li>
<li class=''><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
</ul>
  <h2><a href="/rest/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest/usage/'>Usage</a></li>
<li class=''><a href='/rest/channels-messages/'>Channels &amp; Messages</a></li>
<li class=''><a href='/rest/presence/'>Presence</a></li>
<li class=''><a href='/rest/authentication/'>Authentication</a></li>
<li class=''><a href='/rest/history/'>History</a></li>
<li class=''><a href='/rest/statistics/'>Statistics</a></li>
<li class=''><a href='/rest/encryption/'>Encryption</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/recovery/'>Connection Recovery</a></li>
<li class='selected'><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/other/client-lib-developer/'>Notes (To be deleted)</a></li>
</ul>
  <h2>Other</h2>
<ul>
<li class=''><a href='/other/authentication/'>Authentication</a></li>
<li class=''><a href='/other/webhooks/'>Receiving Webhooks</a></li>
</ul>
  <ul>
<li class=''><a href='/other/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
<li><a href="https://ably.io">Visit Ably.io</a></li>
</ul>
</div>
</body>
</html>
