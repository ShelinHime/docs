<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - Publish & Subscribe Tutorial</title>
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/vendor/prettify/prettify.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheet.css" media="screen">

    

    <script src="/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/kjua-0.1.1.min.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/base64.js" type="text/javascript"></script>

    <script src="/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="//cdn.ably.io/lib/ably.min.js" type="text/javascript"></script>

    <script src="/javascripts/application.js" type="text/javascript"></script>
    <script src="/javascripts/lang-manager.js" type="text/javascript"></script>

    

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.5">
  </head>
  <body>
    <div class="canonical-notice">
      <img src="/images/icon-alert.png">
      <span class="canonical-notice-text">
        You are viewing our bleeding edge unstable documentation. We recommend you use our <a href="https://www.ably.io/documentation">stable documentation »</a>
      </span>
      <img src="/images/icon-alert.png">
    </div>
    <div class="fork-banner"><a href="https://github.com/ably/docs"><img src="/images/forkme.png" alt="Fork me on GitHub"></a></div>

  <div id="documentation">
    
    <header>
      
      
        <h1 id="title">Publish &amp; Subscribe Tutorial</h1>
      
    </header>
    <article>
      <p>The Ably Realtime service organises the message traffic within applications into named channels. Channels are the “unit” of message distribution; clients attach to any number of channels to subscribe to messages, and every message published to a channel is broadcasted to all subscribers. This scalable and resilient messaging pattern is commonly called pub/sub.</p>
<p>As you can publish a message to any channel, channels provide a means for you to filter data by topic or enforce access control for your subscribers. Only subscribers for those channesl will receive those messages.</p>
<p>Messages published can contain string, JSON object, JSON array or binary data payloads.</p>
<p><a href="/realtime/channels-messages">Publishing and subscribing for messages on channels with our channel API</a> is trivial. Let&#8217;s get started.</p>
<h2>Step 1 &#8211; Set up a free account with Ably</h2>
<p>In order to run these tutorials locally, you will need an <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a>. If you are not already signed up, you should <a href="https://www.ably.io/signup">sign up now for a free Ably account</a>.  Once you have an Ably account:</p>
<ol>
	<li><a href="https://support.ably.io/support/solutions/articles/3000030053-how-do-i-access-my-app-dashboard">Log into your app dashboard</a></li>
	<li>Under &#8220;Your apps&#8221;, click on &#8220;Manage app&#8221; for any app you wish to use for this tutorial, or create a new one with the &#8220;Create New App&#8221; button</li>
	<li>Click on the &#8220;API Keys&#8221; tab</li>
	<li>Copy the secret &#8220;API Key&#8221; value from your Root key and store it so that you can use it later in this tutorial<br />
<a href="/images/tutorials/copy-api-key.png" target="_blank"><br />
  <img src="/images/tutorials/copy-api-key.png" style="width: 100%" alt="Copy API Key screenshot"><br />
</a></li>
</ol>
<h2>Step 2 &#8211; Install Ably</h2>


<div lang="javascript"> <!-- start javascript language block -->
<p>To start using Ably in your web app, you first need to include the Ably library. We recommend that you include the latest client library from our CDN using a simple <code>&lt;script&gt;</code> tag. The client library must be instanced with the API key you copied in Step 1. Note in production we recommend you always use the <a href="/general/authentication#token-authentication">token authentication scheme</a> for browser clients, however in this example we use an API key for simplicity.</p>
<p>Include the code below just before your closing your HTML <code>&lt;/html&gt;</code> tag.</p>
<pre lang="javascript"><code lang="javascript">&lt;script src="//cdn.ably.io/lib/ably-0.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
  var realtime = new Ably.Realtime(apiKey);
&lt;/script&gt;</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/843128d">See this step in Github</a></p>

</div> <!-- /end javascript language block -->



<div lang="nodejs"> <!-- start nodejs language block -->
<p>To start using Ably you first need to install the NPM module. The NPM module can be installed as follows:</p>
<pre lang="sh"><code lang="sh">npm install ably</code></pre>
<p>The client library must be instanced with the API key you copied in Step 1. API keys used with <a href="/general/authentication#basic-authentication">basic authentication</a> for your own servers is generally preferred, however clients running on insecure devices should always use the <a href="/general/authentication#token-authentication">token authentication scheme</a> instead. In this example, we use an API key for simplicity.</p>
<p>Add the following to a file named <code>example.js</code> to instance the Ably library inside your Node.js server:</p>
<pre lang="nodejs"><code lang="nodejs">var Ably = require("ably");
var realtime = new Ably.Realtime({ key: apiKey });</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/f8a9f4a">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>To start using Ably you first need to install the Ably RubyGem. The RubyGem can be installed as follows:</p>
<pre lang="sh"><code lang="sh">gem install ably</code></pre>
<p>Or if using bundler, simply add the following to your Gemfile and run <code>bundle install</code>:</p>
<pre lang="ruby"><code lang="ruby">gem 'ably'</code></pre>
<p>The client library must be instanced with the API key you copied in Step 1. API keys used with <a href="/general/authentication#basic-authentication">basic authentication</a> for your own servers is generally preferred, however clients running on insecure devices should always use the <a href="/general/authentication#token-authentication">token authentication scheme</a> instead. In this example, we use an API key for simplicity.</p>
<p>The Ruby realtime library uses <a href="https://github.com/eventmachine/eventmachine">EventMachine</a> to run the client library within an asynchronous event loop. However, typically when using Ruby on servers, most developers use the synchronous <a href="/rest">REST client library API</a>. As this turorial needs realtime access to subscribe to messages, it uses the Ruby realtime library.</p>
<p>Add the following to a file named <code>example.rb</code> to instance the Ably library inside an EventMachine reactor:</p>
<pre lang="ruby"><code lang="ruby">require 'ably'
EventMachine.run do
  ably = Ably::Realtime.new(key: api_key)
end</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/0ec2c7e">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<h2>Step 3 &#8211; Subscribe to messages</h2>
<p>Now that the library is installed, you can subscribe to messages published on channels. Every app can have an arbitrary number of channels that should be used to filter the messages received by subscribing clients. For example, if building a news feed, you may want one channel for politics named &#8220;politics&#8221;, and another for sport named &#8220;sport&#8221;. A user interested in &#8220;sport&#8221; can subscribe to the &#8220;sport&#8221; channel to receive updates. If that user is not subscribed to the &#8220;politics&#8221; channel, then &#8220;politics&#8221; updates will not be delivered to that user.</p>


<div lang="javascript"> <!-- start javascript language block -->
<pre lang="javascript"><code lang="javascript">var channel = realtime.channels.get("sport");
channel.subscribe(function(msg) {
  alert("Received: " + JSON.stringify(msg.data));
});</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/de53537">See this step in Github</a></p>

</div> <!-- /end javascript language block -->



<div lang="nodejs"> <!-- start nodejs language block -->
<pre lang="nodejs"><code lang="nodejs">var channel = realtime.channels.get("sport");
channel.subscribe(function(msg) {
  console.log("Received: " + JSON.stringify(msg.data));
});</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/334016a">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<pre lang="ruby"><code lang="ruby">channel = ably.channels.get('sport')
channel.subscribe do |msg|
  puts "Received: #{msg.data}"
end</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/75becbf">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<h2>Step 4 &#8211; Publishing a message</h2>
<p>Publishing a message on a channel ensures that any number of subscribers on that channel receive the message in real time. To publish a message on the &#8220;sports&#8221; channel we simply call the publish method on the channel, specify an optional message event name, and provide the payload as the second argument.</p>


<div lang="javascript"> <!-- start javascript language block -->
<pre lang="javascript"><code lang="javascript">var channel = realtime.channels.get("sport");
channel.publish("update", { "team": "Man United" });</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/140583e">See this step in Github</a></p>

</div> <!-- /end javascript language block -->



<div lang="nodejs"> <!-- start nodejs language block -->
<pre lang="nodejs"><code lang="nodejs">var channel = realtime.channels.get("sport");
channel.publish("update", { "team": "Man United" });</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/f831895">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<pre lang="ruby"><code lang="ruby">channel = ably.channels.get('sport')
channel.publish 'update', 'team' =&gt; 'Man United'</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/212b65b">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<p>We&#8217;re done, it&#8217;s that simple. We have now shown you how to subscribe to messages on a channel, and then publish messages on a channel. To see this in action, try out the live demo below.</p>
<h2 id="live-demo">Live demo</h2>
<div id="qr-code" style="float: right; margin: 0 0 15px 15px; width: 200px; display: none; text-align: center">
  <div style="margin-top: 5px">Scan this on your mobile</div>
</div>
<p><a href="#" id="new-browser" target="_blank">Open this demo in a new browser window</a> to see publish &amp; subscribe in action.  Alternatively, scan the QR code to see the published message delivered in real time.</p>
<div>
<div>
Message: <input type="text" id="message-text" value="Wowser, that was fast"> <button id="send-message">Send a message</button>
</div>
  <textarea id="result" rows="10" style="width: 60%; margin-top: 10px; font-family: courier, courier new; background-color: #333; color: orange" disabled></textarea>
</div>
<p><img src="/images/ably-logo-white-outline.png" id="ably-qr-logo" style="visibility: hidden; width: 1px; height: 1px"></p>
<h2>Download tutorial source code</h2>


<div lang="javascript"> <!-- start javascript language block -->
<p>The complete source code for each step of <a href="https://github.com/ably/tutorials/commits/publish-subscribe-javascript">this tutorial is available on Github</a>.</p>
<p>We recommend that you clone the repo locally:</p>
<pre lang="sh"><code lang="sh">git clone https://github.com/ably/tutorials.git</code></pre>
<p>Checkout the tutorial branch:</p>
<pre lang="sh"><code lang="sh">git checkout publish-subscribe-javascript</code></pre>
<p>And then run the demo locally by adding your <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a> to <code>example.html</code> and opening the page in your browser.</p>

</div> <!-- /end javascript language block -->



<div lang="nodejs"> <!-- start nodejs language block -->
<p>The complete source code for each step of <a href="https://github.com/ably/tutorials/commits/publish-subscribe-nodejs">this tutorial is available on Github</a>.</p>
<p>We recommend that you clone the repo locally:</p>
<pre lang="sh"><code lang="sh">git clone https://github.com/ably/tutorials.git</code></pre>
<p>Checkout the tutorial branch:</p>
<pre lang="sh"><code lang="sh">git checkout publish-subscribe-nodejs</code></pre>
<p>And then run the demo locally by adding your <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a> to <code>example.js</code> and running the demo <code>node example.js</code></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>The complete source code for each step of <a href="https://github.com/ably/tutorials/commits/publish-subscribe-ruby">this tutorial is available on Github</a></p>
<p>We recommend that you clone the repo locally:</p>
<pre lang="sh"><code lang="sh">git clone https://github.com/ably/tutorials.git</code></pre>
<p>Checkout the tutorial branch:</p>
<pre lang="sh"><code lang="sh">git checkout publish-subscribe-ruby</code></pre>
<p>And then run the demo locally by adding your <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a> to <code>example.rb</code> and running the demo <code>bundle exec ruby example.rb</code></p>

</div> <!-- /end ruby language block -->

<h2>Next steps</h2>
<p>1. If you would like to find out more about how channels, publishing and subscribing works, see the <a href="https://www.ably.io/documentation/realtime/channels-messages">Realtime channels &amp; messages documentation</a><br />
2. Learn more about <a href="https://www.ably.io/features">Ably features</a> by stepping through our other <a href="https://www.ably.io/tutorials">Ably tutorials</a><br />
3. Gain a good technical <a href="https://www.ably.io/documentation/how-ably-works">overview of how the Ably realtime platform works</a><br />
4. <a href="https://www.ably.io/contact">Get in touch if you need help</a></p>
<script src="//cdn.ably.io/lib/ably.min.js"></script><script src="https://apis.google.com/js/api.js"></script><script type="text/javascript">
  $(function() {
    var ably = new Ably.Realtime({ authUrl: 'https://www.ably.io/ably-auth/token/docs' }),
        channelName = getQueryParam('channel') || getRandomChannelName(),
        channel = ably.channels.get(channelName),
        $result = $('#result');

    ably.connection.on('connecting', function() {
      log("[Connecting to Ably...]");
    });

    ably.connection.on('connected', function() {
      log("[Connected to Ably] Waiting for messages...");
    });

    channel.subscribe(function(msg) {
      log("[Received] " + msg.data);
    });

    $('button#send-message').on('click', function() {
      var text = $('input#message-text').val();
      log("[Publishing...] " + text);
      channel.publish('msg', text);
    });

    /* Set up the link to open a new window with this random channel name */
    var urlWithChannel = document.location.href;
    if (urlWithChannel.indexOf('channel=') < 0) {
      urlWithChannel += (urlWithChannel.indexOf('?') < 0 ? '?' : '&') + "channel=" + escape(channelName);
    }
    $('a#new-browser').attr('href', urlWithChannel + "#live-demo");

    function setupQrCode() {
      var request = gapi.client.urlshortener.url.insert({
        'longUrl': urlWithChannel + "#live-demo"
      });
      request.then(function(response) {
        console.log(response.result.id);
        var qr = kjua({ text: response.result.id, size: 200, ecLevel: 'H', mode: 'image', image: $('img#ably-qr-logo')[0] });
        $('#qr-code').show().prepend(qr);
      }, function(reason) {
        console.error('Error: ' + reason.result.error.message);
      });
    }

    /* Set up QR code with a short URL from goo.gl */
    function init() {
      gapi.client.setApiKey('AIzaSyDXq2c1JjZTSUrzPZESxf4XP_tRu-N8r3A');
      gapi.client.load('urlshortener', 'v1').then(setupQrCode);
    }

    var started = new Date().getTime();
    function log(msg) {
      var timePassed = Math.round((new Date().getTime() - started) / 100) / 10;
      $result.text(timePassed + "s - " + msg + "\n" + $result.text());
    }

    gapi.load('client', init);
  });
</script>
    </article>
    <hr class="back">
    <a href="#documentation">Back to top</a>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/images/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/tutorials/'>Tutorials</a></li>
</ul>
  <h2><a href="/realtime/">Realtime client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class=''><a href='/realtime/authentication/'>Authentication</a></li>
<li class=''><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/encryption/'>Encryption</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
<li class=''><a href='/realtime/types/'>Types</a></li>
</ul>
  <h2><a href="/rest/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest/usage/'>Using the REST library</a></li>
<li class=''><a href='/rest/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/rest/presence/'>Presence</a></li>
<li class=''><a href='/rest/authentication/'>Authentication</a></li>
<li class=''><a href='/rest/history/'>History</a></li>
<li class=''><a href='/rest/encryption/'>Encryption</a></li>
<li class=''><a href='/rest/statistics/'>Statistics</a></li>
<li class=''><a href='/rest/types/'>Types</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2>General</h2>
<ul>
<li class=''><a href='/general/authentication/'>Authentication</a></li>
<li class=''><a href='/general/channel-rules-namespaces/'>Channel Rules and Namespaces</a></li>
<li class=''><a href='/general/push-notifications/'>Mobile push notifications</a></li>
<li class=''><a href='/general/queues/'>Message Queues</a></li>
<li class=''><a href='/general/webhooks/'>Receiving WebHooks</a></li>
<li class=''><a href='/general/statistics/'>Application Statistics</a></li>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/features/'>Features spec v0.9</a></li>
<li class=''><a href='/client-lib-development-guide/feature-prioritisation/'>Feature prioritisation</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/rest-api/'>REST API Definition</a></li>
<li class=''><a href='/client-lib-development-guide/test-api/'>Sandbox Test API</a></li>
<li class=''><a href='/client-lib-development-guide/encryption/'>Encryption</a></li>
<li class=''><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-recovery/'>Connection Recovery</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/connection-fallback/'>Connection host fallback</a></li>
<li class=''><a href='/client-lib-development-guide/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
<li class=''><a href='/code-index/'>Code Examples List</a></li>
</ul>
  <ul>
<li><a href="https://www.ably.io">Visit Ably.io</a></li>
</ul>
</div>

</body>
</html>
