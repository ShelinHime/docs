<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - Client & Server Token Authentication Tutorial</title>
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/vendor/prettify/prettify.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheet.css" media="screen">

    

    <script src="/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/kjua-0.1.1.min.js" type="text/javascript"></script>
    <script src="/vendor/javascripts/base64.js" type="text/javascript"></script>

    <script src="/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="//cdn.ably.io/lib/ably.min.js" type="text/javascript"></script>

    <script src="/javascripts/application.js" type="text/javascript"></script>
    <script src="/javascripts/lang-manager.js" type="text/javascript"></script>

    

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.5">
  </head>
  <body>
    <div class="canonical-notice">
      <img src="/images/icon-alert.png">
      <span class="canonical-notice-text">
        You are viewing our bleeding edge unstable documentation. We recommend you use our <a href="https://www.ably.io/documentation">stable documentation Â»</a>
      </span>
      <img src="/images/icon-alert.png">
    </div>
    <div class="fork-banner"><a href="https://github.com/ably/docs"><img src="/images/forkme.png" alt="Fork me on GitHub"></a></div>

  <div id="documentation">
    
    <header>
      
      
        <h1 id="title">Client &amp; Server Token Authentication Tutorial</h1>
      
    </header>
    <article>
      <p>Ably supports two types of authentication schemes. Basic authentication uses one of your private API keys and is the simplest scheme designed for use by your servers. Token authentication is mostly used by your device and browser clients whereby a short-lived secure token is issued to them by your servers.</p>
<p>Most of our <a href="/tutorials">other tutorials</a> demonstrate the use of the simple <a href="/general/authentication#basic-authentication">basic authentication scheme</a>. In this tutorial we are focussing how you can use the recommended <a href="/general/authentication#token-authentication">token authentication scheme</a> for your untrusted clients.</p>
<p>It is important to bear in mind that when using token authentication, unlike with basic authentication, the client should not be given a token at time is instanced. This is because the token will expire. Instead, the client should be configured with a means to obtain a token whenever it needs to authenticate with Ably. As tokens typically expire every hour, which minimises the impact of compromise on a client device or browser, it is necessary that the client can obtain a new token to authenticate whenever the token expires or needs refreshing.</p>
<p>Let&#8217;s get started and show you how a typical client server architecture using token authentication.</p>
<h2>Step 1 &#8211; Set up a free account with Ably</h2>
<p>In order to run these tutorials locally, you will need an <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a>. If you are not already signed up, you should <a href="https://www.ably.io/signup">sign up now for a free Ably account</a>.  Once you have an Ably account:</p>
<ol>
	<li><a href="https://support.ably.io/support/solutions/articles/3000030053-how-do-i-access-my-app-dashboard">Log into your app dashboard</a></li>
	<li>Under &#8220;Your apps&#8221;, click on &#8220;Manage app&#8221; for any app you wish to use for this tutorial, or create a new one with the &#8220;Create New App&#8221; button</li>
	<li>Click on the &#8220;API Keys&#8221; tab</li>
	<li>Copy the secret &#8220;API Key&#8221; value from your Root key and store it so that you can use it later in this tutorial<br />
<a href="/images/tutorials/copy-api-key.png" target="_blank"><br />
  <img src="/images/tutorials/copy-api-key.png" style="width: 100%" alt="Copy API Key screenshot"><br />
</a></li>
</ol>
<h2>Step 2 &#8211; Install Ably on your server</h2>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>To start using Ably on your Node.js server, you first need to install the NPM module. The NPM module can be installed as follows:</p>
<pre lang="sh"><code lang="sh">npm install ably</code></pre>
<p>The server client library must be instanced with the private API key you copied in Step 1. This will ensure that the <a href="/general/authentication#basic-authentication">basic authentication scheme</a> is used, which is almost always the right choice for your own trusted servers where risk of compromise of your API key credentials is low.</p>
<p>Add the following to a file named <code>server.js</code> to instance the Ably library inside your Node.js server:</p>
<pre lang="nodejs"><code lang="nodejs">var Ably = require("ably");
var rest = new Ably.Rest({ key: apiKey });</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/d848af7">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>To start using Ably you first need to install the Ably RubyGem. The RubyGem can be installed as follows:</p>
<pre lang="sh"><code lang="sh">gem install ably</code></pre>
<p>Or if using bundler, simply add the following to your <code>Gemfile</code> and run <code>bundle install</code>:</p>
<pre lang="ruby"><code lang="ruby">gem 'ably'</code></pre>
<p>The server client library must be instanced with the private API key you copied in Step 1. This will ensure that the <a href="/general/authentication#basic-authentication">basic authentication scheme</a> is used, which is almost always the right choice for your own trusted servers where risk of compromise of your API key credentials is low.</p>
<p>As we do not need asynchronous access to the realtime API for this tutorial, we&#8217;ll be using the simpler <a href="/rest">REST client library</a>.</p>
<pre lang="ruby"><code lang="ruby">require 'ably'
ably = Ably::Rest.new(key: api_key)</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/9e06aaf">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<h2>Step 3 &#8211; Set up your web server</h2>
<p>Before a client connects to Ably, it will check if it has suitable credentials to authenticate with Ably. As we&#8217;ll be using the recommended <a href="/general/authentication#token-authentication">token authentication scheme</a> in the client for this demo, when the client starts up and attempt to connect to Ably, it will request a token immediately so that it can then authenticate with Ably.</p>
<p>As tokens are typically issued from your own web servers, we&#8217;ll set up a simple web server now for this tutorial.</p>


<div lang="nodejs"> <!-- start nodejs language block -->
<p><a href="https://expressjs.com/">Express.js</a> is a very popular and simple web framework for Node.js. Let&#8217;s get this setup:</p>
<p>First we&#8217;ll add the <code>express</code> NPM module and create a <code>package.json</code>:</p>
<pre lang="json"><code lang="json">{
  "name": "ably-tutorials",
  "repository": "https://github.com/ably/tutorials",
  "license": "Apache-2.0",
  "engines": {
    "node": "&gt;=0.10"
  },
  "scripts": {
    "start": "node ./server.js"
  },
  "dependencies": {
    "ably": "&gt;=0.8",
    "express": "~4.0"
  }
}</code></pre>
<p>Then we&#8217;ll set up a vanilla HTTP Express.js server in <code>server.js</code>:</p>
<pre lang="nodejs"><code lang="nodejs">const express = require('express'),
      app = express();

app.get('/', function (req, res) {
  res.send('Hello, I am a very simple server');
});

app.listen(3000, function () {
  console.log('Web server listening on port 3000');
});</code></pre>
<p>If you would like to try running the server now, you can do so with <code>node server.js</code>. Once running, open your browser to <a href="http://localhost:3000/">http://localhost:3000/</a> and you should see the text &#8220;Hello, I am a very simple server&#8221;.</p>
<p><a href="https://github.com/ably/tutorials/commit/ec3b24c">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p><a href="http://www.sinatrarb.com/">Sinatra</a> is a very simple and popular web server framework for Ruby. Rails is arguably more popular as a web server framework, however for the purposes of this tutorial it is overkill. Bear in mind that all the code in this tutorial can be used as is within Rails. You will need to configure routes in <code>routes.rb</code>, add the code to a controller, and then add the HTML to a view.</p>
<p>Let&#8217;s get going with a simple Sinatra web server now. Add the <code>sinatra</code> RubyGem to your <code>Gemfile</code> and then run <code>bundle install</code>:</p>
<pre lang="ruby"><code lang="ruby">gem 'sinatra'</code></pre>
<p>Now set up a vanilla Sinatra server in <code>server.rb</code>:</p>
<pre lang="ruby"><code lang="ruby">require 'sinatra'
get '/' do
  'Hello, I am a very simple server'
end</code></pre>
<p>If you would like to try running the server now, you can do so with <code>bundle exec ruby server.rb</code>. Once running, open your browser to <a href="http://localhost:4567/">http://localhost:4567/</a> and you should see the text &#8220;Hello, I am a very simple server&#8221;.</p>
<p><a href="https://github.com/ably/tutorials/commit/0e9e6db">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<h2>Step 4 &#8211; Respond to authentication requests</h2>
<p>Before we move onto the client, let&#8217;s first make sure the web server is capable of issuing token request to clients that need to authenticate with Ably. However, instead of jumping into code, lets quickly talk about how token authentication works and what the difference is between a <a href="https://www.ably.io/documentation/realtime/authentication#token-details"><code>Token</code></a> and <a href="https://www.ably.io/documentation/realtime/authentication#token-request"><code>TokenRequest</code></a> is.</p>
<p>When a client needs to authenticate, it will automatically send a request to the authentication URL you provide, which is normally a URL on your server. Alternatively if you provide a callback instead of an authentication URL, it will invoke your callback and wait for it to respond with token details. See the <a href="https://www.ably.io/documentation/realtime/authentication#auth-options">auth options documentation</a> for more info on the options available.</p>
<p>Your web server or callback, following an authentication request, is then responsible for providing the client library with a <a href="https://www.ably.io/documentation/realtime/authentication#token-details"><code>Token</code></a> or a <a href="https://www.ably.io/documentation/realtime/authentication#token-request"><code>TokenRequest</code></a>. The token can contain permissions (we call then capabilities) and an identity for the client, but we&#8217;ll look at that functionality later.</p>
<p>For now you need to understand how token requests and tokens differ and why in most cases we recommend you issue token requests as opposed to tokens.</p>
<h4>Tokens</h4>
<p>All clients authenticating with Ably must use either an API key or a token. Tokens are obtained by sending a <a href="https://www.ably.io/documentation/realtime/authentication#token-request"><code>TokenRequest</code></a> containing the required token spec to the Ably service.  The token may include a set of capabilities (permissions such as subscribe access to a specific channel), an identity (such as logged-in user&#8217;s unique ID) or a TTL (the time before it expires).</p>
<h4>Token Requests</h4>
<p>Token requests, unlike tokens, are created and signed by your server without having to communicate with Ably. A token request is simply a JSON object that contains a pre-authorization from your servers for a client, effectively stating &#8220;Ably, with this signed token, I authorize you to issue a token according to the permissions, ID and TTL specied, to whoever hands this to you&#8221;. Ably is then able to inspect the signature to ensure the token request is indeed from the your server and signed with your private API key, and issue a token to the client requesting the token. Ably ensures that token requests can only be used soon after creation and can only be used once.</p>
<p>Therefore, as it is possible to issue token requests without any communication to Ably (in the form of an HTTP request), we recommend that when a client needs to authenticate, you should provide a signed token request. This approach minimises the amount of work your servers need to do by distributing the task of obtaining a token from the Ably service using the token request to your clients instead.</p>
<p>In this step we will get the local web server ready to respond to authentication requests by issuing a token request to the requesting client. By adding the following route to your Express.js server, it is now ready to service clients wanting to authenticate with Ably.</p>


<div lang="nodejs"> <!-- start nodejs language block -->
<pre lang="nodejs"><code lang="nodejs">/* Issue token requests to clients sending a request to the /auth endpoint */
app.get('/auth', function (req, res) {
  var tokenParams = {}; /* Use token defaults for now */
  rest.auth.createTokenRequest(tokenParams, function(err, tokenRequest) {
    if (err) {
      res.status(500).send('Error requesting token: ' + JSON.stringify(err));
    } else {
      res.setHeader('Content-Type', 'application/json');
      res.send(JSON.stringify(tokenRequest));
    }
  });
});</code></pre>
<p>Try running your server again with <code>node server.js</code> and visiting <a href="http://localhost:3000/auth">http://localhost:3000/auth</a> and you should see a JSON token request in the form:</p>
<pre lang="json"><code lang="json">{
  "keyName": "I2ACJQ.Lv8AUQ",
  "ttl": 3600000,
  "timestamp": 1473894038255,
  "capability": "{\"*\":[\"*\"]}",
  "nonce": "f6799a8e7fa6f77b8e1dac55314789b1",
  "mac": "35nifY9SRZ8KRDfKOPIS1qYWGP16r2lD59zJo9TH8pA="
}</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/6a40d84">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<pre lang="ruby"><code lang="ruby">require 'json'

# Issue token requests to clients sending a request to the /auth endpoint
get '/auth' do
  content_type :json
  ably.auth.create_token_request.to_json
end</code></pre>
<p>Try running your server again with <code>bundle exec ruby server.rb</code> and visiting <a href="http://localhost:4567/auth">http://localhost:4567/auth</a> and you should see a JSON token request in the form:</p>
<pre lang="json"><code lang="json">{
  "keyName": "I2ACJQ.Lv8AUQ",
  "ttl": 3600000,
  "timestamp": 1473894038255,
  "capability": "{\"*\":[\"*\"]}",
  "nonce": "f6799a8e7fa6f77b8e1dac55314789b1",
  "mac": "35nifY9SRZ8KRDfKOPIS1qYWGP16r2lD59zJo9TH8pA="
}</code></pre>
<p><a href="https://github.com/ably/tutorials/commit/5575d73">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<h2>Step 5 &#8211; Setting up a client to use token authentication</h2>
<p>Now that we have a web server running and an authentication endpoint, we are ready to setup the Ably Realtime client that uses token auth.</p>
<p>First we need to set up a simple HTML page that will be served by the web server. Create the following HTML file named <code>index.html</code> in the same folder as <code>server.js</code>:</p>
<pre lang="html"><code lang="html">&lt;html&gt;
  &lt;head&gt;
    &lt;script src="https://cdn.ably.io/lib/ably.min.js" type="text/javascript"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Token auth example&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>Now we need to serve a static home page. Let&#8217;s replace the code that responds to the <code>/</code> route (look for <code>get '/' do ... end</code>) with the following:</p>
<pre lang="nodejs"><code lang="nodejs">app.use('/', express.static(__dirname));</code></pre>
<p>Try running your server again with <code>node server.js</code> and visiting <a href="http://localhost:3000/">http://localhost:3000/</a> to make sure the new static home page is being served up correctly. If you can see the static page, then it&#8217;s time to set up a Realtime client that uses token authentication.</p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>Now we need to serve a static home page. Let&#8217;s replace the code that responds to the <code>/</code> route (look for <code>app.get('/', ...</code>) with the following:</p>
<pre lang="ruby"><code lang="ruby">get '/' do
  File.read('index.html')
end</code></pre>
<p>Try running your server again with <code>bundle exec ruby server.rb</code> and visiting <a href="http://localhost:4567/">http://localhost:4567/</a> to make sure the new static home page is being served up correctly. If you can see the static page, then it&#8217;s time to set up a Realtime client that uses token authentication.</p>

</div> <!-- /end ruby language block -->

<p>Add the following above the closing <code>&lt;/html&gt;</code> tag in your <code>index.html</code> file:</p>
<pre lang="html"><code lang="html">&lt;script type="text/javascript"&gt;
  /* Set up a Realtime client that authenticates with the local web server auth endpoint */
  var realtime = new Ably.Realtime({ authUrl: '/auth' });
  realtime.connection.once('connected', function() {
    alert("We're connected using the token request from the server /auth endpoint!");
  });
&lt;/script&gt;</code></pre>
<p>So let&#8217;s see what happens now. Restart the local server and refresh the page. You should receive an alert to confirm that you&#8217;re connected to Ably which means your server has successfully issued a token request to the client, the client has then obtained a token from Ably with the token request, it has subsequently authenticated and finally connected.</p>


<div lang="nodejs"> <!-- start nodejs language block -->
<p><a href="https://github.com/ably/tutorials/commit/f63b65e">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p><a href="https://github.com/ably/tutorials/commit/ef41176">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<p>You&#8217;ve now covered the basics of client / server token authentication and your client has a means to renew the token whenever it needs one.</p>
<h2>Step 6 &#8211; Authenticating logged in users</h2>
<p>In the previous step we demonstrated how easy it is to issue a token request from your server for clients that need to authenticate with Ably. However, the example is quite contrived in that it is unlikely you would want to issue tokens to anonymous users with a full set of capabilities. At present, the token issued allows all users to publish, subscribe, be present, retrieve stats and history across all channels.</p>
<p>In this step we&#8217;ll show you how to issue subscribe only tokens limited to a single channel for anonymous users, and issue publish and subscribe tokens for logged in users. As the purpose of this tutorial is not demonstrate how to build an authentication system for your website, we have implemented a trivial and clearly flawed authentication system so that we can keep superfluous unrelated code to a minimum.</p>
<p>Let&#8217;s get started. First we will add two panels, one that contains a simple login form, and the other with log out link to the HTML page. Add the following beneath the <code>&lt;/h1&gt;</code> tag in your <code>index.html</code> file:</p>
<pre lang="html"><code lang="html">&lt;div id="panel-anonymous"&gt;
  &lt;h3&gt;Login&lt;/h3&gt;
  &lt;form action="/login"&gt;
    &lt;input type="text" name="username" placeholder="Enter your username"&gt;
    &lt;input type="submit" value="Login"&gt;
  &lt;/form&gt;
&lt;/div&gt;
&lt;div id="panel-logged-in"&gt;
  Your are logged in. &lt;a href="/logout"&gt;Log out&lt;/a&gt;
&lt;/div&gt;</code></pre>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>Now we need to enable the login and logout functionality in the web server. In order to keep this tutorial simple, when a user logs in we&#8217;ll set a cookie, and when they log out we&#8217;ll clear the cookie. Add the following routes to your <code>server.js</code> file.</p>
<pre lang="nodejs"><code lang="nodejs">/* Set a cookie when the user logs in */
app.get('/login', function (req, res) {
  /* Login the user without credentials.
     This is an over simplified authentication system
     to keep this tutorial simple */
  if (req.query['username']) {
    res.cookie('username', req.query['username']);
    res.redirect('/');
  } else {
    res.status(500).send('Username is required to login');
  }
});

/* Clear the cookie when the user logs outs */
app.get('/logout', function (req, res) {
  res.clearCookie('username');
  res.redirect('/');
});</code></pre>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>Now we need to enable the login and logout functionality in the web server. In order to keep this tutorial simple, when a user logs in we&#8217;ll set a cookie, and when they log out we&#8217;ll clear the cookie.</p>
<p>We need to add cookie support to Sinatra, so add the following to your <code>Gemfile</code> and <code>bundle install</code>:</p>
<pre lang="ruby"><code lang="ruby">gem 'sinatra-contrib'</code></pre>
<p>Add the following routes to your <code>server.rb</code> file.</p>
<pre lang="ruby"><code lang="ruby">require 'sinatra/cookies'

# Set a cookie when the user logs in
get '/login' do
  # Login the user without credentials.
  # This is an over simplified authentication system
  # to keep this tutorial simple
  if request.params['username']
    cookies[:username] = request.params['username']
    redirect to('/')
  else
    status 500
    'Username is required to login'
  end
end

# Clear the cookie when the user logs outs
get '/logout' do
  cookies.delete 'username'
  redirect to('/')
end</code></pre>

</div> <!-- /end ruby language block -->

<p>Both the logged in and anonymous HTML panels will currently show on the HTML page, let&#8217;s add quickly hide or show them based on the cookie set above. Add the following just before the final <code>&lt;/script&gt;</code> tag in <code>index.html</code></p>
<pre lang="javascript"><code lang="javascript">var loggedIn = document.cookie.indexOf('username') &gt;= 0;
document.getElementById('panel-anonymous').
  setAttribute('style', "display: " + (loggedIn ? 'none' : 'block'));
document.getElementById('panel-logged-in').
  setAttribute('style', "display: " + (loggedIn ? 'block' : 'none'));</code></pre>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>Now that we have a means to determine if a user is logged in or logged out using the session cookie, we can issue restricted subscribe-only token requests for anonymous users and publish and subscribe token requests for logged in users. Replace the <code>var tokenParams = {};</code> code in your <code>server.js</code> with the following:</p>
<pre lang="nodejs"><code lang="nodejs">var tokenParams;
/* Check if the user is logged in */
if (req.cookies.username) {
  /* Issue a token request with pub &amp; sub permissions on all channels +
     configure the token with an indentity */
  tokenParams = {
    'capability': { '*': ['publish', 'subscribe'] },
    'clientId': req.cookies.username
  };
} else {
  /* Issue a token with subscribe privileges restricted to one channel
     and configure the token without an identity (anonymous) */
  tokenParams = {
    'capability': { 'notifications': ['subscribe'] }
  };
}</code></pre>
<p>Unfortunately Express.js is very lightweight and does not support cookie parsing out of the box. We need to add the <code>cookie-parser</code> NPM module to Express.js. Add the following to your <code>package.json</code> file:</p>
<pre lang="json"><code lang="json">{
  ...
  "dependencies": {
    "ably": "&gt;=0.8",
    "express": "~4.0",
    "cookie-parser": "~1.4"
  }
}</code></pre>
<p>And add the following to the top of your <code>server.js</code> file, beneath the Express.js require, so that cookies are parsed:</p>
<pre lang="nodejs"><code lang="nodejs">const cookieParser = require('cookie-parser');
app.use(cookieParser());</code></pre>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>Now that we have a means to determine if a user is logged in or logged out using the session cookie, we can issue restricted subscribe-only token requests for anonymous users and publish and subscribe token requests for logged in users. Replace the <code>get '/auth' do ... end</code> code in your <code>server.rb</code> with the following:</p>
<pre lang="ruby"><code lang="ruby">require 'sinatra/cookies'

# Allow cookies to be read in the browser
set :cookie_options, httponly: false

# Issue token requests to clients sending a request to the /auth endpoint
get '/auth' do
  content_type :json

  # Check if the user is logged in
  token_params = if cookies[:username]
    # Issue a token request with pub &amp; sub permissions on all channels +
    #   configure the token with an indentity
    {
      capability: { '*' =&gt; ['publish', 'subscribe'] },
      client_id: cookies[:username]
    }
  else
    # Issue a token with subscribe privileges restricted to one channel
    #   and configure the token without an identity (anonymous)
    {
      capability: { 'notifications' =&gt; ['subscribe'] }
    }
  end
  ably.auth.create_token_request(token_params).to_json
end</code></pre>

</div> <!-- /end ruby language block -->

<p>Finally, before we test this new functionality, let&#8217;s update the alert so that it shows the authentication details after it connects to Ably. Replace <code>alert("We're connected...</code> with the following:</p>
<pre lang="javascript"><code lang="javascript">var user = realtime.auth.tokenDetails.clientId || 'anonymous';
var capability = realtime.auth.tokenDetails.capability;
alert(
  'You are now connected to Ably \n' +
  'User: ' + user + ' \n' +
  'Capabilities: ' + capability
);</code></pre>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>Ok, we&#8217;re ready to see all of this in action. Restart the local server <code>node server.js</code> and then refresh the page at <a href="http://localhost:3000/">http://localhost:3000/</a>. You should receive an alert to confirm that you&#8217;re connected as an anonymous with limited capabilities as follows:</p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>Ok, we&#8217;re ready to see all of this in action. Restart the local server <code>bundle exec ruby server.rb</code> and then refresh the page at <a href="http://localhost:4567/">http://localhost:4567/</a>. You should receive an alert to confirm that you&#8217;re connected as an anonymous with limited capabilities as follows:</p>

</div> <!-- /end ruby language block -->

<p><a href="/images/tutorials/token-authentication-anonymous.png" target="_blank"><br />
  <img src="/images/tutorials/token-authentication-anonymous.png" style="width: 457px" alt="Token auth details for anonymous"><br />
</a></p>
<p>Now enter a username and click &#8220;login&#8221;, and you should receive an alert confirming you are authenticated with Ably as an indentified user with additional privileges to subscribe and publish on all channels as follows:</p>
<p><a href="/images/tutorials/token-authentication-mike.png" target="_blank"><br />
  <img src="/images/tutorials/token-authentication-mike.png" style="width: 429px" alt="Token auth details for logged in user Mike"><br />
</a></p>


<div lang="nodejs"> <!-- start nodejs language block -->
<p><a href="https://github.com/ably/tutorials/commit/ad72480">See this step in Github</a></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p><a href="https://github.com/ably/tutorials/commit/5dda1dd">See this step in Github</a></p>

</div> <!-- /end ruby language block -->

<p>We&#8217;ve covered a lot of ground in this tutorial. However authentication is one of the more challenging parts to understand as it requires you to have a good overall understanding of how it all works. We strongly recommend you see below for essential further reading to help you understand authentication in more detail for use in your servers and apps.</p>
<h2>Download tutorial source code</h2>


<div lang="nodejs"> <!-- start nodejs language block -->
<p>The complete source code for each step of <a href="https://github.com/ably/tutorials/commits/token-authentication-nodejs">this tutorial is available on Github</a>.</p>
<p>We recommend that you clone the repo locally:</p>
<pre lang="sh"><code lang="sh">git clone https://github.com/ably/tutorials.git</code></pre>
<p>Checkout the tutorial branch:</p>
<pre lang="sh"><code lang="sh">git checkout token-authentication-nodejs</code></pre>
<p>And then run the demo locally by adding your <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a> to <code>server.js</code> and running the demo <code>node server.js</code></p>

</div> <!-- /end nodejs language block -->



<div lang="ruby"> <!-- start ruby language block -->
<p>The complete source code for each step of <a href="https://github.com/ably/tutorials/commits/token-authentication-ruby">this tutorial is available on Github</a>.</p>
<p>We recommend that you clone the repo locally:</p>
<pre lang="sh"><code lang="sh">git clone https://github.com/ably/tutorials.git</code></pre>
<p>Checkout the tutorial branch:</p>
<pre lang="sh"><code lang="sh">git checkout token-authentication-ruby</code></pre>
<p>And then run the demo locally by adding your <a href="https://support.ably.io/support/solutions/articles/3000030502-setting-up-and-managing-api-keys">Ably API key</a> to <code>server.rb</code> and running the demo <code>bundle exec ruby server.rb</code></p>

</div> <!-- /end ruby language block -->

<h2>Next steps</h2>
<p>1. Find out how <a href="/general/authentication#selecting-auth">Basic Auth and Token Auth differ and how to choose the right authentication scheme</a><br />
2. Read up on <a href="/general/authentication#basic-authentication">Basic Auth</a> and <a href="/rest/authentication#basic-authentication">how to use Basic Auth on your server using the REST library</a><br />
3. Read up on <a href="/general/authentication#basic-authentication">Token Auth</a> and <a href="/realtime/authentication#token-authentication">how to use Token Auth on a client using the Realtime library</a><br />
4. <a href="/general/authentication#capabilities-explained" title="permissions">Understand and see some examples of how to define capabilities</a> for tokens and token requests<br />
5. Discover how <a href="/realtime/authentication#identified-clients">identities in tokens allow clients and servers to trust other clients&#8217; identities</a> validated and provided by your servers<br />
6. Learn more about other <a href="https://www.ably.io/features">Ably features</a> by stepping through our other <a href="https://www.ably.io/tutorials">Ably tutorials</a><br />
7. Gain a good technical <a href="https://www.ably.io/documentation/how-ably-works">overview of how the Ably realtime platform works</a><br />
8. <a href="https://www.ably.io/contact">Get in touch if you need help</a></p>
    </article>
    <hr class="back">
    <a href="#documentation">Back to top</a>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/images/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/tutorials/'>Tutorials</a></li>
</ul>
  <h2><a href="/realtime/">Realtime client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class=''><a href='/realtime/authentication/'>Authentication</a></li>
<li class=''><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/encryption/'>Encryption</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
<li class=''><a href='/realtime/types/'>Types</a></li>
</ul>
  <h2><a href="/rest/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest/usage/'>Using the REST library</a></li>
<li class=''><a href='/rest/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/rest/presence/'>Presence</a></li>
<li class=''><a href='/rest/authentication/'>Authentication</a></li>
<li class=''><a href='/rest/history/'>History</a></li>
<li class=''><a href='/rest/encryption/'>Encryption</a></li>
<li class=''><a href='/rest/statistics/'>Statistics</a></li>
<li class=''><a href='/rest/types/'>Types</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2>General</h2>
<ul>
<li class=''><a href='/general/authentication/'>Authentication</a></li>
<li class=''><a href='/general/channel-rules-namespaces/'>Channel Rules and Namespaces</a></li>
<li class=''><a href='/general/push-notifications/'>Mobile push notifications</a></li>
<li class=''><a href='/general/queues/'>Message Queues</a></li>
<li class=''><a href='/general/webhooks/'>Receiving WebHooks</a></li>
<li class=''><a href='/general/statistics/'>Application Statistics</a></li>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/features/'>Features spec v0.9</a></li>
<li class=''><a href='/client-lib-development-guide/feature-prioritisation/'>Feature prioritisation</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/rest-api/'>REST API Definition</a></li>
<li class=''><a href='/client-lib-development-guide/test-api/'>Sandbox Test API</a></li>
<li class=''><a href='/client-lib-development-guide/encryption/'>Encryption</a></li>
<li class=''><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-recovery/'>Connection Recovery</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/connection-fallback/'>Connection host fallback</a></li>
<li class=''><a href='/client-lib-development-guide/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
<li class=''><a href='/code-index/'>Code Examples List</a></li>
</ul>
  <ul>
<li><a href="https://www.ably.io">Visit Ably.io</a></li>
</ul>
</div>

</body>
</html>
