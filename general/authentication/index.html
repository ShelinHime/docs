<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - Authentication</title>
    <link rel="shortcut icon" href="/assets/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/assets/vendor/prettify/prettify.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/assets/stylesheet.css" media="screen">

    <script src="/assets/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/base64.js" type="text/javascript"></script>

    <script src="/assets/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="//cdn.ably.io/lib/ably.min.js" type="text/javascript"></script>

    <script src="/assets/javascripts/application.js" type="text/javascript"></script>
    <script src="/assets/javascripts/lang-manager.js" type="text/javascript"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.5">
  </head>
  <body>
    <div class="canonical-notice">
      <img src="/assets/icon-alert.png">
      <span class="canonical-notice-text">
        You are viewing our bleeding edge unstable documentation. We recommend you use of our <a href="https://www.ably.io/documentation">stable documentation Â»</a>
      </span>
      <img src="/assets/icon-alert.png">
    </div>
    <div class="fork-banner"><a href="https://github.com/ably/docs"><img src="/assets/forkme.png" alt="Fork me on GitHub"></a></div>

  <div id="documentation">
    
      <nav class="jump-to-nav">
        <div class="form">
          <select id="jump-to-nav">
            <option>Jump to ...</option>
            <optgroup label='Help with'>
<option id="anchor-title">Overview</option>
<option id="anchor-getting-started">Getting started</option>
<option id="anchor-selecting-auth">Selecting auth mechanism</option>
<option id="anchor-token-requests">Token requests</option>
</optgroup>
          </select>
        </div>
      </nav>
    
    <header>
      
      
        <h1 id="title">Authentication</h1>
      
    </header>
    <article>
      <p>Both the REST API and the Realtime API use common authentication mechanisms.</p>
<p>Each is based on having a series of keys set up for each application. Each key is configured via the <a href="https://www.ably.io/dashboard">dashboard</a> and exposed as a single string such as <code>{{API_KEY}}</code> which contains information that identifies the key as well as containing the &#8220;secret&#8221; key value.</p>
<p>If you are using an Ably client library then the key can be considered to be an opaque string supplied when the library is instanced.  If you are using the Ably REST authentication endpoint directly, then the API key string can be used in the <a href="http://localhost:4000/rest-api/#basic-authentication">basic authorization header</a></p>
<p>A key is associated with a set of capabilities &#8211; i.e. an explicit indication of which operations (such as publish, subscribe or presence) are allowable using that key. Additionally, the capabilities can be restricted to a set of a resources (which is either a channel namespace or a specific channel).  View <a href="#capabilities">all supported capabilities</a>.</p>
<h2 id="getting-started">Getting started</h2>
<p>The simplest method for authentication with Ably is to use the API key string when instancing the client library Basic Authentication passing the key string to the client library</p>
<p>This method is simple, but suffers from a number of problems that might make it unsuitable for certain use cases:</p>
<ul>
	<li>the secret is passed directly by the client to Ably, so it is not suitable for connections that are not over TLS (HTTPS or non-encrypted realtime connections)</li>
	<li>the secret may be required to be embedded in a script on a public site</li>
	<li>all of the configured capabilities of the key are implicitly possible in any request, and clients that legitimately obtain the secret may then abuse the rights conferred by that key</li>
</ul>
<p>These issues are addressed with the second <a href="#token-requests">token-based authentication method</a>. Tokens are authentication credentials that only have a short lifetime, and therefore they may more readily be distributed to clients where there is a risk of compromise. Tokens may also be issued with a particular scope &#8211; such as a limited set of access rights, or being limited to use by a specific client &#8211; and therefore token-based authentication provides the flexibility to implement access control policies in the application. Tokens may be obtained via the <a href="/rest/authentication">client library authentication API</a> or directly via the Ably <a href="/rest-api">REST API</a>.</p>
<h2 id="selecting-auth">Selecting an authentication mechanism</h2>
<p>When first using the Ably API, it is simplest just to instance the library with the key string which will in turn use Basic authentication for all operations. However, there are many situations in which it is preferable to use the token-based system instead. The following guidance aims to help you choose which system to use in any given situation.</p>
<p>When deciding the mechanism to use, it is necessary to bear in mind the <a href="http://en.wikipedia.org/wiki/Principle_of_least_privilege">principle of least privilege</a>: a client should ideally only possess the credentials and rights that it needs to accomplish what it wants; this way, if the credentials are compromised, the rights that can be abused by an attacker are minimised.</p>
<p>Basic authentication is appropriate where:</p>
<ul>
	<li>the script, program or system holding the key is not exposed; for example, a key should not be embedded in a script in a public-facing web page</li>
	<li>a secure, unmediated connection exists between the client and the Ably service. Keys should only really be sent over a TLS conection (that&#8217;s either an HTTPS connection, or an encrypted realtime connection). A key should not be used over a proxied connection unless the proxy is trusted</li>
	<li>access needs to be granted selectively to groups of clients to specific channels or channel namespaces, but only a small number of such access control groups need to be established</li>
</ul>
<p>Token authentication is appropriate when:</p>
<ul>
	<li>there is a risk of exposure of the client&#8217;s credentials, either directly or over an insecure, or insecurely proxied, connection</li>
	<li>a client is only intended to have use of the service for a limited period of time</li>
	<li>a client needs to have the ability to authenticate its specific identity, but cannot be trusted sufficiently not to masquerade as a different client identity</li>
	<li>fine-grained access needs to be given on a per-client basis to specific channels and/or capabilities</li>
	<li>there may be a requirement to be able to revoke the rights of a client individually</li>
</ul>
<p>Note that many applications will most naturally use a mixed strategy: one or more application servers will use basic authentication to access the service, and to issue tokens, but browser or device clients will use individually-issued tokens.</p>
<h2 id="token-requests">Token requests</h2>
<p>The Ably REST client libraries aim to make things as simple as possible, and it is not necessary to understand all of the details of token requests to interact with the service and issue tokens for clients. However, the details below are relevant if using the <a href="/rest-api/#requesttoken">REST token endpoint directly</a>, or if you are creating token requests on behalf of a client.</p>
<h3>Key format</h3>
<p>A key string is structured as a triple <code>&lt;app id&gt;:&lt;key id&gt;:&lt;key value&gt;</code>, where:</p>
<dl>
	<dt>app id</dt>
	<dd>(public) identifier for the application</dd>
	<dt>key id</dt>
	<dd>(public) identifier for the key in question: this uniquely identifies the key and is a system-assigned, URL-safe, identifier</dd>
	<dt>key value</dt>
	<dd>(private) key &#8220;secret&#8221; string, system-generated, uniquely associated with this key</dd>
</dl>
<h3>Token request format</h3>
<p>A token request is made against the <a href="/rest-api#requesttoken"><code>requestToken</code></a> endpoint, with a JSON token request in the request body. The token request comprises:</p>
<ul>
	<li>the key id</li>
	<li>a capability (i.e. a set of channel names/namespaces and, for each, a set of <a href="#capabilities">operations</a>) which should be a subset of the set of capability associated with the key specified in key id</li>
	<li>optionally, a clientId thus identifying clients using this token and preventing them from identifying themselves with any other clientId</li>
	<li>optionally, an expiry time or TTL</li>
	<li>a timestamp to ensure token request is still valid</li>
	<li>a unique nonce string, randomly-generated by the client</li>
</ul>
<p>A signed token request also contains:</p>
<ul>
	<li>a signature, generated as an HMAC of each of the above components, using the key secret value.</li>
</ul>
<p>Signed token requests can be used to request a token from Ably without an authenticated connection.  The signature generated with the key secret confirms the authenticity of the token and can thus be &#8220;trusted&#8221; by Ably. As signed token requests can be issued without a request to Ably, a server with a valid API key and secret can issue token requests directly to clients, and clients can in turn generate a token by sending the token request to Ably.</p>
<p>The receiving Ably server verifies the signature if present, the timestamp (which must be within 2 minutes of the current time), verifies that the nonce/timestamp combination has not been used previously, verifies that the requested validity period is permitted, and verifies that the requested capabilities are permitted for that token based on the key capabilities.</p>
<p>The server may choose to subset the capabilities based on the capabilities of the key.</p>
<p>The server replies with an access token, which is essentially a signed version of the resolved set of capabilities, plus other metadata associated with the token (such as expiry time).</p>
<p>This access token can then be used for subsequent REST requests or Realtime connections. If a clientId was included in the request, then the token is associated with that clientId, and may be used to authenticate that clientId in operations that require authentication (eg joining a channel that requires authentication).</p>
<h3>Parameter canonicalisation</h3>
<p>The parameters of the token request are normalised/canonicalised as follows:</p>
<dl>
	<dt>key id</dt>
	<dd>no action required</dd>
	<dt>ttl</dt>
	<dd>the decimal integer representation, without leading zeros, of the requested life of the token in seconds, if none is specified a default of 1 hour is used</dd>
	<dt>capability</dt>
	<dd>this is a canonicalised representation of the resource paths and associated operations in the capability. It is the JSON stringified value of an object of the form:<br />
<code lang="json">{
  resource1: [operation1a, operation1b, operation1c, ...],
  resource2: [operation2a, operation2b, operation2c, ...].
  ...
}</code><br />
with the following constraints:<br />
<ul>
<li>all whitespace is removed;</li>
<li>resources are listed in forward lexicographic order</li>
<li>operations are listed in forward lexicographic order</li>
<li>there is no trailing comma on any list of array or object elements</li>
<li>all strings are quoted and escaped as per the JSON standard.</li>
<li>the wildcard @*@ can be used for resource or operation fields</li>
</ul>
</dd>
	<dt>clientId</dt>
	<dd>the canonical form is the unquoted and unescaped string. In the case that no clientId is included in the request, the empty string is used.</dd>
	<dt>timestamp</dt>
	<dd>the decimal integer representation, without leading zeros, of the time of the of the request in seconds since the epoch.</dd>
	<dt>nonce</dt>
	<dd>an unquoted, unescaped random string of at least 16 characters.</dd>
</dl>
<h3 id="capabilities">Capability operations</h3>
<p>The following capability operations are available for API keys and issued tokens.</p>
<dl>
	<dt>subscribe</dt>
	<dd>can subscribe to messages on channels</dd>
	<dt>publish</dt>
	<dd>can publish messages to channels</dd>
	<dt>presence</dt>
	<dd>can register presence on a channel and subscribe to presence state changes on a channel</dd>
	<dt>history</dt>
	<dd>can retrieve message and presence state history on channels</dd>
	<dt>stats</dt>
	<dd>can retrieve current and historical usage statistics for an app</dd>
</dl>
<h3>HMAC calculation</h3>
<p>First the canonicalised request text, constructed as follows:</p>
<ul>
	<li>start with the empty string</li>
	<li>for each of the following fields in order: key id, ttl, capabilities, clientId, timestamp, nonce, even when empty
	<ul>
		<li>append the canonicalised string value for that field</li>
		<li>append a newline (0xa) character.<br />
Note that a newline character is added for each field, including any empty client id string, and the last (nonce) field.</li>
	</ul></li>
</ul>
<p>The resulting string must then the UTF8-encoded and then HMAC value is computed with <a href="http://tools.ietf.org/html/rfc4868">hmac-sha-256</a> using the key secret value.</p>
<p>The HMAC value is then base-64 encoded.</p>
<h3>Request body format</h3>
<p>In the case of a signed token request, the request body is the JSON stringified representation of the object with the form:</p>
<pre lang="json"><code lang="json">{
  id: "&lt;key id&gt;",
  ttl: &lt;expiry in milliseconds&gt;,
  capability: "&lt;capability string&gt;",
  clientId: "&lt;client id optional&gt;",
  timestamp: &lt;timestamp&gt;,
  nonce: "&lt;nonce&gt;",
  mac: "&lt;base 64-encoded HMAC value&gt;"
}</code></pre>
<p>An unsigned token request is identical except that the mac property is omitted. Note that Basic auth must be used in order to request a token with an unsigned request.</p>
<h3>Response body format</h3>
<p>If successful, the authorisation request returns the JSON stringified representation of an object containing the token:</p>
<pre lang="json"><code lang="json">{
  token: "&lt;token value&gt;",
  issued: &lt;timestamp as ms since epoch&gt;,
  expires: &lt;timestamp as ms since epoch&gt;,
  capability: "&lt;canonical capability text&gt;",
  clientId: "&lt;client id optional&gt;"
}</code></pre>
<h3>Example token requests</h3>
<h4>Unsigned token request example</h4>
<pre lang="sh"><code lang="sh">curl -X POST "https://rest.ably.io/keys/{{API_KEY_NAME}}/requestToken" \
 -u "{{API_KEY}}" \
 -H "Content-Type: application/json" \
 --data '{
   "keyName": "{{API_KEY_NAME}}",
   "ttl": "600000",
   "capability":
     "{\"private\":[\"subscribe\",\"publish\",\"presence\"],\"*\":[\"subscribe\"]}",
   "clientId": "John",
   "timestamp": {{SECONDS_SINCE_EPOCH}},
   "nonce": "95e543b88299f6bae83df9b12fbd1ecd"
}'</code></pre>
<p>Responds with JSON token:</p>
<pre lang="json"><code lang="json">{
  "token": "xVLyHw.GdFXtlosUQgfHaU...eUMQgCfFY77fKSUQM0u8vmxJy",
  "keyName": "xVLyHw.zKkAHQ",
  "issued": 1427233520,
  "expires": 1427234120,
  "capability": {
    "*": [
      "subscribe"
    ],
    "private": [
      "presence",
      "publish",
      "subscribe"
    ]
  }
}</code></pre>
<h4>Signed token request example</h4>
<pre lang="sh"><code lang="sh">curl -X POST "https://rest.ably.io/keys/{{API_KEY_NAME}}/requestToken" \
 -H "Content-Type: application/json" \
 --data '{{SIGNED_TOKEN_REQUEST_EXAMPLE}}'</code></pre>
<p>Responds with JSON token:</p>
<pre lang="json"><code lang="json">{
  "token": "xVLyHw.DTSukCRj1lis1sJltr...rhLRBcZgmXLf1FP8wKGrPYkkIs",
  "keyName": "xVLyHw.lwnKYQ",
  "issued": 1427235604,
  "expires": 1427236204,
  "capability": {
    "*": [
      "*"
    ]
  }
}</code></pre>
    </article>
    <hr class="back">
    <a href="#documentation">Back to top</a>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/assets/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/root/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/root/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/root/usage-limits-billing/'>Usage Limits &amp; Billing</a></li>
</ul>
  <h2><a href="/realtime/">Realtime client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class=''><a href='/realtime/authentication/'>Authentication</a></li>
<li class=''><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
<li class=''><a href='/realtime/types/'>Types</a></li>
</ul>
  <h2><a href="/rest/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest/usage/'>Using the REST library</a></li>
<li class=''><a href='/rest/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/rest/presence/'>Presence</a></li>
<li class=''><a href='/rest/authentication/'>Authentication</a></li>
<li class=''><a href='/rest/history/'>History</a></li>
<li class=''><a href='/rest/statistics/'>Statistics</a></li>
<li class=''><a href='/rest/encryption/'>Encryption</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2>General</h2>
<ul>
<li class='selected'><a href='/general/authentication/'>Authentication</a></li>
<li class=''><a href='/general/channel-rules-namespaces/'>Channel Rules and Namespaces</a></li>
<li class=''><a href='/general/webhooks/'>Receiving Webhooks</a></li>
<li class=''><a href='/general/statistics/'>Application Statistics</a></li>
<li class=''><a href='/general/migrating/'>Migrating to Ably</a></li>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/features/'>Features spec v0.8</a></li>
<li class=''><a href='/client-lib-development-guide/feature-prioritisation/'>Feature prioritisation</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/rest-api/'>REST API Definition</a></li>
<li class=''><a href='/client-lib-development-guide/test-api/'>Sandbox Test API</a></li>
<li class=''><a href='/client-lib-development-guide/encryption/'>Encryption</a></li>
<li class=''><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-recovery/'>Connection Recovery</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/connection-fallback/'>Connection host fallback</a></li>
<li class=''><a href='/client-lib-development-guide/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
</ul>
  <ul>
<li><a href="https://www.ably.io">Visit Ably.io</a></li>
</ul>
</div>

</body>
</html>
