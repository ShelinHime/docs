<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - History</title>
    <link rel="stylesheet" type="text/css" href="/assets/stylesheet.css" media="screen">
    <link rel="shortcut icon" href="/assets/favicon.ico">

    <script src="/assets/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="/assets/vendor/prettify/prettify.css" media="screen">
    <script src="/assets/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="/assets/javascripts/application.js" type="text/javascript"></script>
    <script src="/assets/javascripts/lang-manager.js" type="text/javascript"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.2">
  </head>
  <body>
    <a href="https://github.com/ably/docs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/assets/forkme.png" alt="Fork me on GitHub"></a>
  <div id="documentation">
    
      <nav class="jump-to-nav">
        <div class="form">
          <select id="jump-to-nav">
            <option>Jump to ...</option>
            <optgroup label='Help with'>
<option id="anchor-title">History</option>
</optgroup>
<optgroup label='API reference'>
<option id="anchor-channel-history">Channel history</option>
</optgroup>
          </select>
        </div>
      </nav>
    
    <header>
      
        <div class="breadcrumb"><a href="/realtime/">Realtime Client API</a><span class="separator">/</span></div>
      
      
        <h1 id="title">History</h1>
      
    </header>
    <article>
      <p>The Realtime client library provides message history for channels. It provides access to the persisted history, as with the REST API, but also enables access to instantaneous or &#8220;live&#8221; history for attached channels.</p>
<p>This live history provides the ability to obtain continuous message history up to the point that a realtime channel was attached and also supports recent history for channels that do not have persistence enabled.</p>
<h3>History queries</h3>
<p>The REST API provides a <code>GET /messages</code> route on an channel, which performs a query for message history on the channel. These queries may be scoped by <code>start</code> and <code>end</code> time, may be queried in a given <code>direction</code> and may include a <code>limit</code> on the number of records returned.</p>
<p>History results are paginated and therefore accompanied with one or more relative links relating to the current query. Where the number of results returned exceeds the query limit &#8211; which is either the value of the <code>limit</code> param or the default limit of 100 &#8211; the query result contains pages with the limited number of records, and a relative link to the next page.</p>
<p>Responses contain one or more of the following relative links:</p>
<dl>
	<dt><code>first</code></dt>
	<dd>a link to the first page of results for this query. This link also makes the query stable; where params are resolved at query time (particularly <code>end</code> which is resolved to the current time if not specified explicitly) then the <code>first</code> link contains the resolved values of those params so that it will repeatably resolve to the same param values each time. (This does not necessarily mean that the query results will be identical, if the last remaining messages for a given time interval are persisted between two invocations of the same query.)</dd>
</dl>
<dl>
	<dt>current</dt>
	<dd>a stable link to the current page of results.</dd>
</dl>
<dl>
	<dt>next</dt>
	<dd>on each page except the last in a paginated result, the next link is a link to the next page of results.</dd>
</dl>
<p>It is not possible to navigate backwards through a result set, but each page can be obtained by navigating to it by going back to <code>first</code> and then <code>next</code>. Of course, if the intention is to display results in the opposite order, the <code>direction</code> param should be used in the initial query to specify the intended direction of pagination.</p>
<p>Relative links are presented by default as an <a href="http://tools.ietf.org/html/rfc5988">RFC 5988 Link HTTP response header</a>; there is a separate Link header for each relative link accompanying the response. The rel types used are <code>first</code>, <code>next</code> and <code>current</code> as specified in the RFC. A Link header has the format:</p>
<p>bq.<br />
Link: &lt;&lt;url&gt;&gt;; rel=&#8220;&lt;rel&gt;&#8221;</p>
<p>where <code>&lt;url&gt;</code> is the URL of the link and <code>&lt;rel&gt;</code> is the relation type.</p>
<p>For example:</p>
<p>bq.<br />
Link: &lt;./history?start=1380794880000&amp;end=1380794881058&amp;limit=100&amp;by=minute<br />
&amp;direction=forwards&amp;format=json&amp;first_start=1380794880000&gt;; rel=&#8220;first&#8221;</p>
<p>In principle the URL might be any valid URL but in practice it will always be a relative URL, and it must be interpreted relative to the query URL. Clients should treat the URL opaquely; in particular, params (such as <code>first_start</code> in the example above) are undocumented and unsupported except where a client uses the link URL in its entirety.</p>
<p>In the case of a JSON response body format it is also possible to request that the rel response metadata is inline in the response body by specifying <code>rel_format=inline</code> in the request URL. (The <code>rel_format</code> param also takes the value <code>rel_format=link</code> to request Link header metadata explicitly.) In the inline case the response body then has the format:</p>
<pre>
{
    "data": [ ... messages ... ],
    "rel": {
        "first": &lt;URL&gt;,
        ...
    }
}

</pre>
<p>where the <code>data</code> member references the history result in the usual format and each of the rel links associated with the response is present in the <code>rel</code> member, with the link URL in the same format as above.</p>
<h3>Live vs persistent history</h3>
<p>If persistence is enabled for a channel, messages are persisted within the Ably system and can later be retrieved via the history API.</p>
<p>There is a single system-wide view of the persistent history. In practice, however, messages on a channel will not necessarily be delivered in the same order to all clients; messages originating in one region will typically be delivered to other clients in that region sooner than messages originating from other regions. When querying persistent history the messages returned will generally be in timestamp order and will not necessarily have been delivered in that order to any client.</p>
<p>When querying very recent history, however, it is possible to query for the &#8220;live&#8221; history, effectively replaying the event order was it occurred for a specific connection or in a specific region. This live history is available even for channels that do not have persistence enabled.</p>
<p>The live history makes it possible to obtain a history that is continuous with the messages received on an attached channel, in the backwards direction from the point of attachment. When a <code>Channel</code> instance is attached, its <code>attachSerial</code> property is populated with a serial number. This serial can be passed as the value of the <code>from_serial</code> option when querying the history. The serial number must be treated opaquely by the client, and does not necessarily have any meaning outside of the context of the client instance that received that value on attach.</p>
<p>Continuity of message history, form the instantaneous live history back to persistent history, is assured by the Ably system when responding to queries from a realtime client.</p>
<h1>API reference</h1>
<div class="inline-toc">
<ul><li>Application history
<ul>
<li>
Methods
<ul>
<li><a href='#history'>History</a></li>
</ul>
</li>
</ul>
</li></ul>
<ul><li>Channel object history
<ul>
<li>
Methods
<ul>
<li><a href='#channel-history'>History</a></li>
</ul>
</li>
</ul>
</li></ul>
</div><h2 id="channel-history">Channel object history</h2>
<p>With the REST client library, the Channel object must be created in order to retrieve history or stats for the required channel:</p>
<pre lang="javascript"><code lang="javascript">var Rest = new Ably.Rest(options),
    channel = Rest.channels.get('channel0');</code></pre>
<pre lang="ruby"><code lang="ruby">rest = Ably::Rest.new(options)
channel = rest.channels.get('channel0')</code></pre>
<h3>Methods</h3>
<h6>history</h6>
<blockquote class="definition">
<p class="definition">channel.history(options, callback)</p>
</blockquote>
<p>This call queries the REST <a href="/rest-api#channel-history"><code>/apps/&lt;app id&gt;/channels/&lt;channel id&gt;/history</code></a> API</p>
<h4>Parameters</h4>
<dl>
	<dt>options</dt>
	<dd>is an optional object containing the query parameters, as specified in the <a href="/rest-api#channel-history">REST API</a> documentation.</dd>
	<dt>callback</dt>
	<dd>is a function of the form: <code>callback(err, result)</code><br />
where:<br />
<ul><br />
<li><code>err</code> contains an error value on the case of an error response as defined in the <a href="/rest-api#common">REST API</a> documentation</li><br />
<li>On success, <code>result</code> contains an array of results whose type corresponds to the result type for the request granularity as specified in <a href="/rest-api#channel-history">REST API</a></li><br />
</ul></dd>
</dl>
<h4>Request options</h4>
<p>The following options are supported.</p>
<dl>
	<dt>start</dt>
	<dd>Specifies the start of interval covered by the query. Defaults to the beginning of time.<br><br>
The value is either a number (milliseconds since the epoch) or a date/time string that can be parsed by JS Date (eg 2012-12-09:16:38).<br><br>
The given start time is rounded down to the start of the relevant interval depending on the granularity of the query (see below). So, for example, if the query is for stats by minute (which is the default), then the given time will be rounded down to the nearest minute.</dd>
</dl>
<dl>
	<dt>end</dt>
	<dd>Specifies the end of interval covered by the query. Defaults to the current time.<br><br>
The value is either a number (milliseconds since the epoch) or a date/time string that can be parsed by JS Date (eg 2012-12-09:16:38).<br><br>
The interval covered by the query always includes the end time, and covers the entire interval at the requested granularity that includes the end time. (In a sense it is &#8220;rounded up&#8221;, except that the end of the query interval is not a &#8220;round&#8221; time; it&#8217;s the last second of the interval containing the given end time.)</dd>
</dl>
<dl>
	<dt>direction</dt>
	<dd>Specifies the direction that results are to be returned, either backwards (ie most recent interval first) or forwards (ie oldest interval first).<br><br>
The start time and end time are always that &#8211; ie start is earlier than first, even if the direction is backwards. Therefore, when querying backwards, the first returned result will cover the end time.<br><br>
Default is backwards.</dd>
</dl>
<dl>
	<dt>limit</dt>
	<dd>Specifies the maximum number of records to return.</dd>
</dl>
<dl>
	<dt>from_serial</dt>
	<dd>Specifies a message serial number, requesting a history starting from that specific message. A contiguous history, to mesh precisely with the messages received in realtime from an attached channel, can be obtained by passing the appropriate serial number in this option.</dd>
</dl>
<dl>
	<dt>format</dt>
	<dd>Specifies a format for the response, which can be:<br><br>
<ul><br />
<li>json</li><br />
<li>html</li><br />
<li>binary (returns records encoded as Thrift. Note that this feature is at risk for the stats API)</li><br />
If a format is not specified, it is inferred from an Accept or Content-Type header. The header takes precedence.<br><br>
Similarly, in the special case of json only, the request path may include the extension .json which makes a json request.</dd>
</dl>
    </article>
    <hr class="back">
    <a href="#documentation">Back to top</a>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/assets/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/root/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/root/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/root/usage-limits-billing/'>Usage Limits &amp; Billing</a></li>
</ul>
  <h2><a href="/realtime/">Real-time client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class=''><a href='/realtime/authentication/'>Authentication</a></li>
<li class='selected'><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
</ul>
  <h2><a href="/rest-client-library/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest-client-library/usage/'>Using the REST library</a></li>
<li class=''><a href='/rest-client-library/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/rest-client-library/presence/'>Presence</a></li>
<li class=''><a href='/rest-client-library/authentication/'>Authentication</a></li>
<li class=''><a href='/rest-client-library/history/'>History</a></li>
<li class=''><a href='/rest-client-library/statistics/'>Statistics</a></li>
<li class=''><a href='/rest-client-library/encryption/'>Encryption</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2>Other</h2>
<ul>
<li class=''><a href='/other/authentication/'>Authentication</a></li>
<li class=''><a href='/other/webhooks/'>Receiving Webhooks</a></li>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/encryption/'>Encryption</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/recovery/'>Connection Recovery</a></li>
<li class=''><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/client-lib-development-guide/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
</ul>
  <ul>
<li><a href="https://ably.io">Visit Ably.io</a></li>
</ul>
</div>

</body>
</html>
