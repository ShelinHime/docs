<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ably API Documentation - Authentication</title>
    <link rel="stylesheet" type="text/css" href="/assets/stylesheet.css" media="screen">
    <link rel="shortcut icon" href="/assets/favicon.ico">

    <script src="/assets/vendor/javascripts/jquery-1-8-3-min.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/jquery-cookie-1-3-1.js" type="text/javascript"></script>
    <script src="/assets/vendor/javascripts/base64.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="/assets/vendor/prettify/prettify.css" media="screen">
    <script src="/assets/vendor/prettify/prettify-lib.js" type="text/javascript"></script>

    <script src="//cdn.ably.io/lib/ably.min.js" type="text/javascript"></script>

    <script src="/assets/javascripts/application.js" type="text/javascript"></script>
    <script src="/assets/javascripts/lang-manager.js" type="text/javascript"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.5">
  </head>
  <body>
    <a href="https://github.com/ably/docs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/assets/forkme.png" alt="Fork me on GitHub"></a>

  <div id="documentation">
    
      <nav class="jump-to-nav">
        <div class="form">
          <select id="jump-to-nav">
            <option>Jump to ...</option>
            <optgroup label='Help with'>
<option id="anchor-title">Authentication</option>
</optgroup>
<optgroup label='API reference'>
<option id="anchor-request-token">requestToken</option>
<option id="anchor-authorise">authorise</option>
<option id="anchor-create-token-request">createTokenRequest</option>
</optgroup>
<optgroup label='Related types'>
<option id="anchor-auth-options">AuthOptions</option>
<option id="anchor-token-params">TokenParams</option>
<option id="anchor-token-details">TokenDetails</option>
</optgroup>
          </select>
        </div>
      </nav>
    
    <header>
      
        <div class="breadcrumb"><a href="/realtime/">Realtime Client API</a><span class="separator">/</span></div>
      
      
        <h1 id="title">Authentication</h1>
      
    </header>
    <article>
      <p>Clients can access Ably, whether using REST or the Realtime service, by two methods.</p>
<h3>Basic Authentication</h3>
<p><strong>Basic Authentication</strong> directly uses one of the application keys created via the application dashboard. Basic Authentication is the simplest method to use but has two important limitations:</p>
<ul>
	<li>the application key is transmitted over the network as part of a request; therefore it may only be used over TLS (HTTPS or &#8220;SSL&#8221;) connections. This can be a performance disadvantage in some network environments where long round-trip times are amplified by the SSL handshake.</li>
	<li>the client using the API must be in possession of the application key, which potentially exposes the key to compromise. For example, it is not advisable simply to embed the key in a script in a public web page.</li>
</ul>
<pre lang="ruby"><code lang="ruby">client = Ably::Realtime::Client.new(api_key: '')</code></pre>
<h3>Token Authentication</h3>
<p><strong>Token Authentication</strong> uses a token obtained via the REST API <a href="#requesttoken"><code>requestToken</code></a> endpoint. Tokens are authentication tokens that only have a short lifetime, and therefore they may more readily be distributed to clients where there is a risk of compromise. Tokens may also be issued with a particular scope &#8211; such as a limited set of access rights, or being limited to use by a specific client &#8211; and therefore token-based authentication provides the flexibility to implement access control policies in the application. See <a href="/other/authentication">Authentication</a> for more details.</p>
<p>Both the <a href="/rest/usage#constructor">REST</a> and <a href="/realtime/usage#constructor">Realtime</a>, libraries would typically be instanced with either a <code>key</code> or a <code>token</code> option, and these given credentials are used to authenticate requests made by the library. In this situation, the library assumes responsibility for authentication operations, calling any <code>authUrl</code> or <code>authCallback</code> as needed. REST operations and Realtime connections can then proceed using the given credentials with no need to make further calls to the authentication-specific functionality in the library.</p>
<p>The principal use-case for <code>auth</code> object is to make requests for tokens to issue to other clients. A subsidiary use-case is to preemptively trigger renewal of a token or to acquire a new token with a revised set of capabilities.</p>
<p>The REST client library provides the ability to issue tokens using the the <a href="/rest-api#requesttoken"><code>requestToken</code> API endpoint</a>, and also provides a number of helper functions to simplify the use of the authentication API.</p>
<p>The <a href="#requesttoken"><code>requestToken</code></a> endpoint may itself be used without explicit authentication, relying on the implicit authentication of submitting a validly signed token request.</p>
<h1>API Reference</h1>
<div class="inline-toc">
<ul><li>Auth object reference
<ul>
<li>
Methods
<ul>
<li><a href='#request-token'>requestToken</a></li>
<li><a href='#authorise'>authorise</a></li>
<li><a href='#create-token-request'>createTokenRequest</a></li>
</ul>
</li>
<li>
Related types
<ul>
<li><a href='#auth-options'>AuthOptions</a></li>
<li><a href='#token-params'>TokenParams</a></li>
<li><a href='#token-details'>TokenDetails</a></li>
</ul>
</li>
</ul>
</li></ul>
</div><h2 id="auth">Auth object</h2>
<p>The Auth object is available as a <span lang="java">field</span><span lang="default">property</span> of the top-level Ably Realtime instance.</p>
<h3 id="methods">Methods</h3>
<h6 id="request-token"><span lang='default'>requestToken</span><span lang='ruby'>request_token</span></h6>
<blockquote class="definition">
<p class="definition"><span lang='nodejs'>auth.requestToken(options, callback)</span><span lang='ruby'>auth.request_token(options) → json_result</span><span lang='java'>auth.requestToken(AuthOptions options, TokenParams params) → TokenDetails</span></p>
</blockquote>
<h6 lang="java" id="requesttoken">public TokenDetails requestToken(AuthOptions options, TokenParams params)</h6>
<p>Calls the <a href="/rest-api#requesttoken"><code>requestToken</code> API endpoint</a> to obtain a token according to the specified <span lang="default">options</span><span lang="java">authOptions and tokenParams</span>. If the request is successful the resulting <a href="#token-details">TokenDetails</a> instance <span lang="java">is returned</span><span lang="default">is passed back in the callback</span>. If the request is unsuccessful <span lang="java">an appropriate Exception is thrown</span><span lang="default">an appropriate error object is passed to the callback</span>.</p>
<pre lang="nodejs"><code lang="nodejs">client.auth.requestToken(options, function(err, tokenDetails){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token = ' + tokenDetails.id);
});</code></pre>
<pre lang="javascript"><code lang="javascript">client.auth.requestToken(options, function(err, tokenDetails){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token = ' + tokenDetails.id);
});</code></pre>
<pre lang="ruby"><code lang="ruby">begin
  token = client.auth.request_token(options)
  puts "Success; token = #{token[:id]}"
rescue AblyException =&gt; e
  warn e.message
end</code></pre>
<pre lang="java"><code lang="java">try {
  TokenDetails tokenDetails = client.auth.requestToken(authOptions, tokenParams);
  System.out.println("Success; token = " + tokenDetails.id);
} catch(AblyException e) {
  System.out.println("An error occurred; err = " + e.getMessage());
}</code></pre>
<h4>Parameters</h4>
<dl>
	<dt><div lang="default">options</div></dt>
	<dd>an optional object containing any <a href="#auth-options">AuthOptions</a> required to supplement or override the options given when instancing the library, plus any required <a href="#token-params">TokenParams</a> options.</dd>
	<dt><div lang="default">callback</div></dt>
	<dd>is a function of the form: <code>callback(err, result)</code><br />
where:<br />
<ul><li><code>err</code> contains an error object containing the error details</li><br />
<li>On success, <code>result</code> contains the <a href="#token-details">TokenDetails</a> result.</li></ul></dd>
	<dt><div lang="java">AuthOptions authOptions</div></dt>
	<dd>An <a href="#auth-options">AuthOptions</a> instance containing any options to supplement or override the Options given when instancing the library.</dd>
</dl>
<dl>
	<dt><div lang="java">TokenParams tokenParams</div></dt>
	<dd>A <a href="#token-params">TokenParams</a> instance containing the specific parameters of the token request.</dd>
</dl>
<h6 id="authorise">authorise</h6>
<blockquote class="definition">
<p class="definition"><span lang='nodejs'>auth.authorise(options, callback)</span><span lang='ruby'>auth.authorise(options) → json_result</span><span lang='java'>auth.authorise(AuthOptions options, TokenParams params, boolean force) → TokenDetails</span></p>
</blockquote>
<p>Ensures valid auth credentials are present for the library instance. This may rely on an already-known and valid token, and will obtain a new token if necessary or explicitly requested via the <a href="/rest-api#requesttoken"><code>requestToken</code> API endpoint</a>.</p>
<p>In the event that a new token request is made, the specified <span lang="default">options</span><span lang="java">authOptions and tokenParams</span> are used. If the check or a subsequent request is successful the resulting <a href="#token-details">TokenDetails</a> instance <span lang="java">is returned</span><span lang="default">is passed back in the callback</span>. If the request is unsuccessful <span lang="java">an appropriate Exception is thrown</span><span lang="default">an appropriate error object is passed to the callback</span>.</p>
<pre lang="nodejs"><code lang="nodejs">client.auth.authorise(options, function(err, tokenDetails){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token = ' + tokenDetails.id);
});</code></pre>
<pre lang="javascript"><code lang="javascript">client.auth.authorise(options, function(err, tokenDetails){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token = ' + tokenDetails.id);
});</code></pre>
<pre lang="java"><code lang="java">try {
  TokenDetails tokenDetails = client.auth.authorise(authOptions, tokenParams, false);
  System.out.println("Success; token = " + tokenDetails.id);
} catch(AblyException e) {
  System.out.println("An error occurred; err = " + e.getMessage());
}</code></pre>
<h4>Parameters</h4>
<dl>
	<dt><div lang="default">options</div></dt>
	<dd>an optional object containing any <a href="#auth-options">AuthOptions</a> required to supplement or override the options given when instancing the library, plus any required <a href="#token-params">TokenParams</a> options. A further boolean <code>force</code> option is supported which indicates that a new token should be requested, even if a current token is still valid.</dd>
	<dt><div lang="default">callback</div></dt>
	<dd>is a function of the form: <code>callback(err, result)</code><br />
where:<br />
<ul><li><code>err</code> contains an error object containing the error details</li><br />
<li>On success, <code>result</code> contains the <a href="#token-details">TokenDetails</a> result.</li></ul></dd>
	<dt><div lang="java">AuthOptions authOptions</div></dt>
	<dd>An <a href="#auth-options">AuthOptions</a> instance containing any options to supplement or override the Options given when instancing the library.</dd>
</dl>
<dl>
	<dt><div lang="java">TokenParams tokenParams</div></dt>
	<dd>A <a href="#token-params">TokenParams</a> instance containing the specific parameters of the token request.</dd>
</dl>
<dl>
	<dt><div lang="java">boolean force</div></dt>
	<dd>A boolean indicating that a new token should be requested, even if a current token is still valid.</dd>
</dl>
<h6 id="create-token-request"><span lang='default'>createTokenRequest</span><span lang='ruby'>create_token_request</span></h6>
<blockquote class="definition">
<p class="definition"><span lang='nodejs'>auth.createTokenRequest(options, callback)</span><span lang='ruby'>auth.create_token_request(options) → String</span><span lang='java'>auth.createTokenRequest(AuthOptions options, TokenParams params) → String</span></p>
</blockquote>
<p>Creates and signs a token request based on the specified <span lang="default">options</span><span lang="java">authOptions and  tokenParams</span>. Note this can only be used when the key value is available locally. Otherwise, signed token requests must be obtained from the key owner (either using the token request callback or url). Use this to generate signed token requests in order to implement a token request callback for use by other clients.</p>
<p>If the request is successful the resulting token request is JSON-encoded and <span lang="java">returned</span><span lang="default">passed back in the callback</span>. If the request is unsuccessful <span lang="java">an appropriate Exception is thrown</span><span lang="default">an appropriate error object is passed to the callback</span>.</p>
<pre lang="nodejs"><code lang="nodejs">client.auth.createTokenRequest(options, function(err, tokenRequest){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token request = ' + tokenRequest);
});</code></pre>
<pre lang="javascript"><code lang="javascript">client.auth.createTokenRequest(options, function(err, tokenRequest){
  if(err)
    console.log('An error occurred; err = ' + err.message);
  else
    console.log('Success; token request = ' + tokenRequest);
});</code></pre>
<pre lang="java"><code lang="java">try {
  String tokenRequest = client.auth.createTokenRequest(authOptions, tokenParams);
  System.out.println("Success; token = " + tokenRequest);
} catch(AblyException e) {
  System.out.println("An error occurred; err = " + e.getMessage());
}</code></pre>
<h4>Parameters</h4>
<dl>
	<dt><div lang="default">options</div></dt>
	<dd>an optional object containing any <a href="#auth-options">AuthOptions</a> required to supplement or override the options given when instancing the library, plus any required <a href="#token-params">TokenParams</a> options.</dd>
	<dt><div lang="default">callback</div></dt>
	<dd>is a function of the form: <code>callback(err, result)</code><br />
where:<br />
<ul><li><code>err</code> contains an error object containing the error details</li><br />
<li>On success, <code>result</code> contains the <a href="#token-details">TokenDetails</a> result.</li></ul></dd>
	<dt><div lang="java">AuthOptions authOptions</div></dt>
	<dd>An <a href="#auth-options">AuthOptions</a> instance containing any options to supplement or override the Options given when instancing the library.</dd>
</dl>
<dl>
	<dt><div lang="java">TokenParams tokenParams</div></dt>
	<dd>A <a href="#token-params">TokenParams</a> instance containing the specific parameters of the token request.</dd>
</dl>
<h2 id="auth-options">AuthOptions</h2>
<p>An <code>AuthOptions</code> object contains credentials and related options in support of interacting with the Ably service. <code>AuthOptions</code> are a subset of the Ably library <a href="/realtime/usage#options">Options</a>. Various methods on the Auth object take <span lang="java">an AuthOptions argument</span><span lang="default">one or more AuthOptions options</span> to enable the authentication of the requesting client to the service.<br />
Options specified in this way will supplement or override the corresponding options given when the library was instanced.</p>
<p>AuthOptions <span lang="java">fields</span><span lang="default">options</span> are as follows.</p>
<dl>
	<dt><span lang="java">public TokenCallback</span> authCallback</dt>
	<dd>A callback to call to obtain a signed token request. This enables a client to obtain token requests from another entity, so tokens can be renewed without the client requiring access to keys.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> authUrl</dt>
	<dd>A URL to query to obtain a signed token request. This enables a client to obtain token requests from another entity, so tokens can be renewed without the client requiring access to keys.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> keyId</dt>
	<dd>A keyId. This is used in instances where a full key or token are not provided at initialisation.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> keyValue</dt>
	<dd>The secret keyValue for an Ably key associated with this client.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> authToken</dt>
	<dd>An authentication token issued for this application against a specific key and TokenParams</dd>
</dl>
<dl>
	<dt><span lang="java">public Param[]</span> authHeaders</dt>
	<dd>Headers to be included in any request made by the library to the authURL.</dd>
</dl>
<dl>
	<dt><span lang="java">public Param[]</span> authParams</dt>
	<dd>Query params to be included in any request made by the library to the authURL.</dd>
</dl>
<dl>
	<dt><span lang="java">public boolean</span> queryTime</dt>
	<dd>This may be set in instances that the library is to sign token requests based on a given key. If true, the library will query the Ably system for the current time instead of relying on a locally-available time of day.</dd>
</dl>
<h2 id="token-params">TokenParams</h2>
<p>A <code>TokenParams</code> object is associated with a token request and contains the parameters of the request, corresponding to the desired attributes of the token. Methods on the Auth object that may trigger a token request take <span lang="java">a TokenParams argument</span><span lang="default">one or more TokenParams options</span>.</p>
<p>TokenParams <span lang="java">fields</span><span lang="default">options</span> are as follows.</p>
<dl>
	<dt><span lang="java">public String</span> id</dt>
	<dd>The id of the key against which this request is made.</dd>
</dl>
<dl>
	<dt><span lang="java">public long</span> ttl</dt>
	<dd>[default = 3600 (1 hour)] Requested time to live for the token in seconds. If none is specified a default of 1 hour is provided. The maximum lifetime is 24 hours or less depending on application settings and the attributes of the issuing key; any request exceeding that lifetime will be rejected with an error.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> capability</dt>
	<dd>[default = &#8220;{\&#8221;<strong>\&#8220;: [&#8221;</strong>&#8220;]}&#8221; (JSON string)] The capability to associate with the access token. If none is specified, a token will be requested with all of the capabilities of the specified key. If the token request is successful, the capability of the returned token will be the intersection of this capability with the capability of the issuing key.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> client_id</dt>
	<dd>A clientId to associate with this token. The generated token may be used to authenticate as this clientId.</dd>
</dl>
<dl>
	<dt><span lang="java">public long</span> timestamp</dt>
	<dd>The timestamp (in seconds since the epoch) of this request. Timestamps, in conjunction with the nonce, are used to prevent token requests from being replayed.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> nonce</dt>
	<dd>An opaque nonce string of at least 16 characters to ensure uniqueness of this request. Any subsequent request using the same nonce will be rejected.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> mac</dt>
	<dd>The Message Authentication Code (MAC) for this request. See <a href="/rest/authentication">the Authentication documentation</a> for more details on the construction of the MAC.</dd>
</dl>
<h2 id="token-details">TokenDetails</h2>
<p>A <code>TokenDetails</code> object contains the parameters of a response from a successful token request the service. This contains the token string itself plus various items of metadata relating to that token.</p>
<p>TokenDetails <span lang="java">fields</span><span lang="default">properties</span> are as follows.</p>
<dl>
	<dt><span lang="java">public String</span> id</dt>
	<dd>The token itself.</dd>
</dl>
<dl>
	<dt><span lang="java">public long</span> expires</dt>
	<dd>The time (in seconds since the epoch) at which this token expires.</dd>
</dl>
<dl>
	<dt><span lang="java">public long</span> issuedAt</dt>
	<dd>The time (in seconds since the epoch) at which this token was issued.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> capability</dt>
	<dd>The capability associated with this token. See <a href="/rest/authentication">the Authentication documentation</a> for more details on capabilities.</dd>
</dl>
<dl>
	<dt><span lang="java">public String</span> clientId</dt>
	<dd>The clientId, if any, bound to this token. If a clientId is included, then the token authenticates its bearer as that clientId, and the token may only be used to perform operations on behalf of that clientId.</dd>
</dl>
    </article>
    <hr class="back">
    <a href="#documentation">Back to top</a>
  </div>
  <div id="sidebar">
  <a href="/" title="API Documentation Home"><img src="/assets/ably-logo.png" class="ably-logo" title="API Documentation Home"></a>
  <ul>
<li class=''><a href='/root/quick-start-guide/'>Quickstart Guide</a></li>
<li class=''><a href='/root/how-ably-works/'>How Ably works</a></li>
<li class=''><a href='/root/usage-limits-billing/'>Usage Limits &amp; Billing</a></li>
</ul>
  <h2><a href="/realtime/">Real-time client lib</a></h2>
<ul>
<li class=''><a href='/realtime/usage/'>Using the Realtime library</a></li>
<li class=''><a href='/realtime/connection/'>Connection</a></li>
<li class=''><a href='/realtime/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/realtime/presence/'>Presence</a></li>
<li class='selected'><a href='/realtime/authentication/'>Authentication</a></li>
<li class=''><a href='/realtime/history/'>History</a></li>
<li class=''><a href='/realtime/statistics/'>Statistics</a></li>
</ul>
  <h2><a href="/rest/">REST client lib</a></h2>
<ul>
<li class=''><a href='/rest/usage/'>Using the REST library</a></li>
<li class=''><a href='/rest/channels-messages/'>Channels and Messages</a></li>
<li class=''><a href='/rest/presence/'>Presence</a></li>
<li class=''><a href='/rest/authentication/'>Authentication</a></li>
<li class=''><a href='/rest/history/'>History</a></li>
<li class=''><a href='/rest/statistics/'>Statistics</a></li>
<li class=''><a href='/rest/encryption/'>Encryption</a></li>
</ul>
  <h2><a href="/rest-api/">REST API</a></h2>
<ul>
</ul>
  <h2>Other</h2>
<ul>
<li class=''><a href='/other/authentication/'>Authentication</a></li>
<li class=''><a href='/other/webhooks/'>Receiving Webhooks</a></li>
<li class=''><a href='/other/statistics/'>Application Statistics</a></li>
<li class=''><a href='/other/migrating/'>Migrating to Ably</a></li>
</ul>
  <h2><a href="/client-lib-development-guide/">Library Development</a></h2>
<ul>
<li class=''><a href='/client-lib-development-guide/comet/'>Comet Transport</a></li>
<li class=''><a href='/client-lib-development-guide/connection-manager/'>Connection Manager</a></li>
<li class=''><a href='/client-lib-development-guide/encryption/'>Encryption</a></li>
<li class=''><a href='/client-lib-development-guide/protocol/'>Realtime Protocol Definition</a></li>
<li class=''><a href='/client-lib-development-guide/recovery/'>Connection Recovery</a></li>
<li class=''><a href='/client-lib-development-guide/websocket/'>WebSocket Transport</a></li>
<li class=''><a href='/client-lib-development-guide/documentation-formatting-guide/'>Documentation Formatting Guide</a></li>
</ul>
  <ul>
<li><a href="https://ably.io">Visit Ably.io</a></li>
</ul>
</div>

</body>
</html>
